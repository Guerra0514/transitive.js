{"version":3,"sources":["pointlabel.js"],"names":["PointLabel","parent","labelAngle","labelPosition","getName","display","text","getText","labelAnchor","anchor","x","y","textHeight","attrs","fontSize","drawText","fill","orientation","markerBBox","getMarkerBBox","offset","width","height","textWidth","bboxSide","Math","sqrt","obj","intersectsBBox","getBBox","callback","mainLabel","isFocused","setVisibility","transition","style","call"],"mappings":"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","file":"pointlabel.js","sourcesContent":["import Label from './label'\n\n/**\n * Label object\n */\n\nexport default class PointLabel extends Label {\n  constructor (parent) {\n    super(parent)\n\n    this.labelAngle = 0\n    this.labelPosition = 1\n  }\n\n  initText () {\n    return this.parent.getName()\n  }\n\n  /*render (display) {\n    this.svgGroup = display.svg.append('g') // this.parent.labelSvg;\n    this.svgGroup\n      .attr('class', 'transitive-sortable')\n      .datum({\n        owner: this,\n        sortableType: 'POINT_LABEL'\n      })\n\n    var typeStr = this.parent.getType().toLowerCase()\n\n    this.mainLabel = this.svgGroup.append('text')\n      .datum({\n        owner: this\n      })\n      .attr('id', 'transitive-' + typeStr + '-label-' + this.parent.getId())\n      .text(this.getText())\n      .attr('font-size', this.fontSize)\n      .attr('font-family', this.fontFamily)\n      .attr('class', 'transitive-' + typeStr + '-label')\n  }\n\n  refresh (display) {\n    if (!this.labelAnchor) return\n\n    if (!this.svgGroup) this.render(display)\n\n    this.svgGroup\n      .attr('text-anchor', this.labelPosition > 0 ? 'start' : 'end')\n      .attr('transform', (d, i) => {\n        return 'translate(' + this.labelAnchor.x + ',' + this.labelAnchor\n          .y + ')'\n      })\n\n    this.mainLabel\n      .attr('transform', (d, i) => {\n        return 'rotate(' + this.labelAngle + ', 0, 0)'\n      })\n  }*/\n\n  render (display) {\n    const text = this.getText()\n    if (!text || !this.labelAnchor) return\n\n    const anchor = {\n      x: this.labelAnchor.x,\n      y: this.labelAnchor.y - this.textHeight / 2\n    }\n\n    // define common style attributes for the halo and main text\n    const attrs = {\n      'fill': '#000',\n      'font-size': this.fontSize,\n      'text-anchor': this.labelPosition > 0 ? 'start' : 'end'\n    }\n\n    // draw the halo\n    display.drawText(text, anchor, Object.assign({}, attrs, {\n      'stroke': '#fff',\n      'stroke-width': 3,\n      'stroke-opacity': 0.75,\n      fill: 'none'\n    }))\n\n    // draw the main text\n    display.drawText(text, anchor, attrs)\n  }\n\n  setOrientation (orientation) {\n    this.orientation = orientation\n\n    var markerBBox = this.parent.getMarkerBBox()\n    if (!markerBBox) return\n\n    var x, y\n    var offset = 5\n\n    if (orientation === 'E') {\n      x = markerBBox.x + markerBBox.width + offset\n      y = markerBBox.y + markerBBox.height / 2\n      this.labelPosition = 1\n      this.labelAngle = 0\n    } else if (orientation === 'W') {\n      x = markerBBox.x - offset\n      y = markerBBox.y + markerBBox.height / 2\n      this.labelPosition = -1\n      this.labelAngle = 0\n    } else if (orientation === 'NE') {\n      x = markerBBox.x + markerBBox.width + offset\n      y = markerBBox.y - offset\n      this.labelPosition = 1\n      this.labelAngle = -45\n    } else if (orientation === 'SE') {\n      x = markerBBox.x + markerBBox.width + offset\n      y = markerBBox.y + markerBBox.height + offset\n      this.labelPosition = 1\n      this.labelAngle = 45\n    } else if (orientation === 'NW') {\n      x = markerBBox.x - offset\n      y = markerBBox.y - offset\n      this.labelPosition = -1\n      this.labelAngle = 45\n    } else if (orientation === 'SW') {\n      x = markerBBox.x - offset\n      y = markerBBox.y + markerBBox.height + offset\n      this.labelPosition = -1\n      this.labelAngle = -45\n    } else if (orientation === 'N') {\n      x = markerBBox.x + markerBBox.width / 2\n      y = markerBBox.y - offset\n      this.labelPosition = 1\n      this.labelAngle = -90\n    } else if (orientation === 'S') {\n      x = markerBBox.x + markerBBox.width / 2\n      y = markerBBox.y + markerBBox.height + offset\n      this.labelPosition = -1\n      this.labelAngle = -90\n    }\n\n    this.labelAnchor = {\n      x: x,\n      y: y\n    }\n  }\n\n  getBBox () {\n    if (this.orientation === 'E') {\n      return {\n        x: this.labelAnchor.x,\n        y: this.labelAnchor.y - this.textHeight,\n        width: this.textWidth,\n        height: this.textHeight\n      }\n    }\n\n    if (this.orientation === 'W') {\n      return {\n        x: this.labelAnchor.x - this.textWidth,\n        y: this.labelAnchor.y - this.textHeight,\n        width: this.textWidth,\n        height: this.textHeight\n      }\n    }\n\n    if (this.orientation === 'N') {\n      return {\n        x: this.labelAnchor.x - this.textHeight,\n        y: this.labelAnchor.y - this.textWidth,\n        width: this.textHeight,\n        height: this.textWidth\n      }\n    }\n\n    if (this.orientation === 'S') {\n      return {\n        x: this.labelAnchor.x - this.textHeight,\n        y: this.labelAnchor.y,\n        width: this.textHeight,\n        height: this.textWidth\n      }\n    }\n\n    var bboxSide = this.textWidth * Math.sqrt(2) / 2\n\n    if (this.orientation === 'NE') {\n      return {\n        x: this.labelAnchor.x,\n        y: this.labelAnchor.y - bboxSide,\n        width: bboxSide,\n        height: bboxSide\n      }\n    }\n\n    if (this.orientation === 'SE') {\n      return {\n        x: this.labelAnchor.x,\n        y: this.labelAnchor.y,\n        width: bboxSide,\n        height: bboxSide\n      }\n    }\n\n    if (this.orientation === 'NW') {\n      return {\n        x: this.labelAnchor.x - bboxSide,\n        y: this.labelAnchor.y - bboxSide,\n        width: bboxSide,\n        height: bboxSide\n      }\n    }\n\n    if (this.orientation === 'SW') {\n      return {\n        x: this.labelAnchor.x - bboxSide,\n        y: this.labelAnchor.y,\n        width: bboxSide,\n        height: bboxSide\n      }\n    }\n  }\n\n  intersects (obj) {\n    if (obj instanceof Label) {\n      // todo: handle label-label intersection for diagonally placed labels separately\n      return this.intersectsBBox(obj.getBBox())\n    } else if (obj.x && obj.y && obj.width && obj.height) {\n      return this.intersectsBBox(obj)\n    }\n\n    return false\n  }\n\n  runFocusTransition (display, callback) {\n    if (this.mainLabel) {\n      if (this.parent.isFocused()) this.setVisibility(true)\n      this.mainLabel.transition()\n        .style('opacity', this.parent.isFocused() ? 1 : 0)\n        .call(callback)\n    }\n  }\n}\n"]}