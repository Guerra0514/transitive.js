{"version":3,"sources":["canvas-display.js"],"names":["CanvasDisplay","transitive","options","el","canvas","setDimensions","width","height","setCanvas","clientWidth","clientHeight","document","createElement","appendChild","window","devicePixelRatio","makeCanvasHiPPI","ctx","getContext","clearRect","upperLeft","attrs","strokeStyle","lineWidth","fillStyle","beginPath","rx","ry","x","y","rect","closePath","fill","stroke","center","arc","r","Math","PI","pathStr","path","Path2D","arr","split","map","parseFloat","str","trim","setLineDash","lineCap","text","anchor","textBaseline","font","fontSize","fontFamily","textAlign","globalAlpha","strokeText","fillText","PIXEL_RATIO","style","context","scale"],"mappings":"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","file":"canvas-display.js","sourcesContent":["import roundedRect from 'rounded-rect'\n\nimport Display from './display'\n\nexport default class CanvasDisplay extends Display {\n  constructor (transitive) {\n    super(transitive)\n\n    const { el, canvas } = transitive.options\n\n    // Handle case of externally-provided canvas\n    if (canvas) {\n      // Set internal dimensions to match those of canvas\n      this.setDimensions(canvas.width, canvas.height)\n      this.setCanvas(canvas)\n\n    // We have a DOM element; create canvas\n    } else if (el) {\n      this.setDimensions(el.clientWidth, el.clientHeight)\n\n      const canvas = document.createElement('canvas')\n      canvas.width = el.clientWidth\n      canvas.height = el.clientHeight\n      el.appendChild(canvas)\n\n      // Check for Hi-PPI display\n      if (window.devicePixelRatio > 1) makeCanvasHiPPI(canvas)\n\n      this.setCanvas(canvas)\n    }\n  }\n\n  setCanvas (canvas) {\n    this.canvas = canvas\n    this.ctx = this.canvas.getContext('2d')\n  }\n\n  clear () {\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height)\n  }\n\n  drawRect (upperLeft, attrs) {\n    this.ctx.strokeStyle = attrs['stroke']\n    this.ctx.lineWidth = attrs['stroke-width']\n    this.ctx.fillStyle = attrs['fill']\n\n    this.ctx.beginPath()\n    if (attrs.rx && attrs.ry && attrs.rx === attrs.ry) {\n      roundedRect(this.ctx, upperLeft.x, upperLeft.y, attrs.width, attrs.height, attrs.rx)\n      // TODO: handle case where rx != ry\n    } else { // ordinary rectangle\n      this.ctx.rect(upperLeft.x, upperLeft.y, attrs.width, attrs.height)\n    }\n    this.ctx.closePath()\n\n    if (attrs['fill']) this.ctx.fill()\n    if (attrs['stroke']) this.ctx.stroke()\n  }\n\n  drawCircle (center, attrs) {\n    this.ctx.beginPath()\n    this.ctx.arc(center.x, center.y, attrs.r, 0, Math.PI * 2, true)\n    this.ctx.closePath()\n\n    if (attrs['fill']) {\n      this.ctx.fillStyle = attrs['fill']\n      this.ctx.fill()\n    }\n    if (attrs['stroke']) {\n      this.ctx.strokeStyle = attrs['stroke']\n      this.ctx.lineWidth = attrs['stroke-width'] || 1\n      this.ctx.stroke()\n    }\n  }\n\n  drawEllipse (center, attrs) {\n    // TODO: implement\n  }\n\n  drawPath (pathStr, attrs) {\n    const path = new Path2D(pathStr)\n\n    this.ctx.strokeStyle = attrs['stroke']\n    this.ctx.lineWidth = attrs['stroke-width']\n\n    // dash array\n    if (attrs['stroke-dasharray']) {\n      const arr = attrs['stroke-dasharray'].split(',').map(str => parseFloat(str.trim()))\n      this.ctx.setLineDash(arr)\n    }\n    // linecap\n    this.ctx.lineCap = attrs['stroke-linecap'] || 'butt'\n\n    this.ctx.stroke(path)\n\n    if (attrs['stroke-dasharray']) this.ctx.setLineDash([])\n  }\n\n  drawText (text, anchor, attrs) {\n    // For equivalence w/ SVG text rendering\n    this.ctx.textBaseline = 'top'\n\n    this.ctx.font = `${attrs.fontSize || '14px'} ${attrs.fontFamily || 'sans-serif'}`\n    if (attrs['text-anchor']) this.ctx.textAlign = attrs['text-anchor']\n\n    if (attrs['stroke']) {\n      this.ctx.strokeStyle = attrs['stroke']\n      if (attrs['stroke-opacity']) this.ctx.globalAlpha = attrs['stroke-opacity']\n      this.ctx.lineWidth = attrs['stroke-width'] || 1\n      this.ctx.strokeText(text, anchor.x, anchor.y)\n    }\n    if (attrs['fill']) {\n      this.ctx.fillStyle = attrs['fill']\n      if (attrs['fill-opacity']) this.ctx.globalAlpha = attrs['fill-opacity']\n      this.ctx.fillText(text, anchor.x, anchor.y)\n    }\n\n    this.ctx.textAlign = 'start'\n    this.ctx.globalAlpha = 1\n  }\n}\n\n// Utility function to support HiPPI displays (e.g. Retina)\nfunction makeCanvasHiPPI (canvas) {\n  const PIXEL_RATIO = 2\n  canvas.style.width = canvas.width + 'px'\n  canvas.style.height = canvas.height + 'px'\n\n  canvas.width *= PIXEL_RATIO\n  canvas.height *= PIXEL_RATIO\n\n  var context = canvas.getContext('2d')\n  context.scale(PIXEL_RATIO, PIXEL_RATIO)\n}\n"]}